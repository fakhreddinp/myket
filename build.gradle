// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:8.1.0'
        classpath 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.8.22'
        
        // Ø¨Ø±Ø§ÛŒ Ú©Ø¯Ù‡Ø§ÛŒ obfuscation Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
        classpath 'com.guardsquare:proguard-gradle:7.3.2'
        
        // Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± GitHub (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        classpath 'com.github.triplet.gradle:play-publisher:3.8.0'
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
        
        // Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ Ù…Ø§ÛŒÚ©Øª Ùˆ Ø³Ø§ÛŒØ± Ø§Ø³ØªÙˆØ±Ù‡Ø§
        maven { url 'https://jitpack.io' }
        maven { url 'https://dl.bintray.com/myket/maven' }
        
        // Ø¨Ø±Ø§ÛŒ Ú©Ø§ÙÙ‡â€ŒØ¨Ø§Ø²Ø§Ø± (Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯)
        maven { url 'https://repo.cafebazaar.ir/artifactory/bazaar-gradle-release' }
    }
}

// ØªÙ†Ø¸ÛŒÙ…Ø§Øªå…¨å±€ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§
ext {
    // Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ SDK
    compileSdkVersion = 34
    minSdkVersion = 21
    targetSdkVersion = 34
    
    // Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
    appCompatVersion = '1.6.1'
    materialVersion = '1.9.0'
    constraintLayoutVersion = '2.1.4'
    retrofitVersion = '2.9.0'
    okhttpVersion = '4.11.0'
    gsonVersion = '2.10.1'
    roomVersion = '2.5.2'
    lifecycleVersion = '2.6.2'
    
    // Ù†Ø³Ø®Ù‡ Ú©Ø¯ Ùˆ Ù†Ø§Ù…
    versionCode = 1
    versionName = "1.0.0"
    
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§ÛŒÚ©Øª
    myketApplicationId = "ir.mservices.market"
    myketBindAddress = "ir.mservices.market.InAppBillingService.BIND"
    myketPermission = "ir.mservices.market.BILLING"
}

// Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒå…¨å±€ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§
subprojects {
    afterEvaluate { project ->
        if (project.hasProperty('android')) {
            android {
                compileSdkVersion rootProject.ext.compileSdkVersion
                
                defaultConfig {
                    minSdkVersion rootProject.ext.minSdkVersion
                    targetSdkVersion rootProject.ext.targetSdkVersion
                    versionCode rootProject.ext.versionCode
                    versionName rootProject.ext.versionName
                    
                    testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
                    
                    // Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ buildConfig Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§
                    buildConfigField("String", "APP_VERSION_NAME", "\"${rootProject.ext.versionName}\"")
                    buildConfigField("int", "APP_VERSION_CODE", "${rootProject.ext.versionCode}")
                }
                
                compileOptions {
                    sourceCompatibility JavaVersion.VERSION_1_8
                    targetCompatibility JavaVersion.VERSION_1_8
                }
                
                buildTypes {
                    debug {
                        debuggable true
                        minifyEnabled false
                        shrinkResources false
                        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
                    }
                    release {
                        debuggable false
                        minifyEnabled true
                        shrinkResources true
                        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                    }
                }
                
                // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² viewBinding Ùˆ dataBinding
                buildFeatures {
                    viewBinding true
                    dataBinding false
                }
                
                // Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ lint (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                lintOptions {
                    abortOnError false
                    checkReleaseBuilds false
                }
                
                // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ùˆ RTL
                resourceConfigurations += ["en", "fa", "ar"]
            }
        }
    }
}

// ØªØ³Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
task clean(type: Delete) {
    delete rootProject.buildDir
}

// ØªØ³Ú© Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
task listDependencies {
    doLast {
        project.allprojects { project ->
            println "Project: ${project.name}"
            project.configurations.each { configuration ->
                if (configuration.isCanBeResolved) {
                    try {
                        configuration.resolvedConfiguration.resolvedArtifacts.each { artifact ->
                            println "  ${artifact.moduleVersion.id}"
                        }
                    } catch (Exception e) {
                        // ignore
                    }
                }
            }
        }
    }
}

// ØªØ³Ú© Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø§Ø®Øª
task buildStatus {
    doLast {
        println "âœ… Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø§ Ù…Ø´Ø®ØµØ§Øª Ø²ÛŒØ± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯:"
        println "   - compileSdk: ${rootProject.ext.compileSdkVersion}"
        println "   - minSdk: ${rootProject.ext.minSdkVersion}"
        println "   - targetSdk: ${rootProject.ext.targetSdkVersion}"
        println "   - version: ${rootProject.ext.versionName} (${rootProject.ext.versionCode})"
        println "   - repositories: Google, MavenCentral, JitPack"
    }
}

// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®Øª
gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(':app:assembleRelease')) {
        println "ğŸš€ Ø³Ø§Ø®Øª Ù†Ø³Ø®Ù‡ Release Ø´Ø±ÙˆØ¹ Ø´Ø¯..."
        // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Release Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
    }
    
    if (taskGraph.hasTask(':app:assembleDebug')) {
        println "ğŸ”§ Ø³Ø§Ø®Øª Ù†Ø³Ø®Ù‡ Debug Ø´Ø±ÙˆØ¹ Ø´Ø¯..."
    }
}

// Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
tasks.withType(Test) {
    testLogging {
        events "passed", "skipped", "failed", "standardOut", "standardError"
        showExceptions true
        exceptionFormat "full"
        showCauses true
        showStackTraces true
    }
}
